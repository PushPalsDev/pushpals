{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "EventEnvelope",
  "type": "object",
  "required": ["protocolVersion", "id", "ts", "sessionId", "type", "payload"],
  "properties": {
    "protocolVersion": {
      "type": "string",
      "const": "0.1.0",
      "description": "Protocol version must be 0.1.0"
    },
    "id": {
      "type": "string",
      "description": "Unique event identifier (e.g., UUID)"
    },
    "ts": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 timestamp"
    },
    "sessionId": {
      "type": "string",
      "description": "Session identifier"
    },
    "type": {
      "type": "string",
      "enum": [
        "log",
        "scan_result",
        "suggestions",
        "diff_ready",
        "approval_required",
        "approved",
        "denied",
        "committed",
        "assistant_message",
        "error",
        "done",
        "agent_status",
        "task_created",
        "task_started",
        "task_progress",
        "task_completed",
        "task_failed",
        "tool_call",
        "tool_result",
        "delegate_request",
        "delegate_response",
        "job_enqueued",
        "job_claimed",
        "job_completed",
        "job_failed"
      ],
      "description": "Event type discriminator"
    },
    "traceId": {
      "type": "string",
      "description": "Optional trace ID for debugging"
    },
    "from": {
      "type": "string",
      "description": "Originator identifier (e.g. client, agent:local1, worker:lint)"
    },
    "to": {
      "type": "string",
      "description": "Destination identifier (e.g. broadcast, agent:local1, worker:queue:default)"
    },
    "correlationId": {
      "type": "string",
      "description": "Threads a whole conversation turn together"
    },
    "parentId": {
      "type": "string",
      "description": "Links tool calls/results under their parent task event"
    },
    "turnId": {
      "type": "string",
      "description": "One per user message; groups all downstream events"
    },
    "payload": {
      "type": "object",
      "description": "Payload depends on event type"
    }
  },
  "additionalProperties": false
}
