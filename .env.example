# PushPals Environment
# Copy this file to `.env` and uncomment values you want to override.
# Bun loads `.env` from the repository root.

# -----------------------------------------------------------------------------
# Data paths
# -----------------------------------------------------------------------------
# Base directory for app state (SQLite files, pusher state, etc.).
# Default: <repo>/outputs/data
# PUSHPALS_DATA_DIR=./outputs/data

# Override specific DB locations (absolute path or path relative to PUSHPALS_DATA_DIR).
# Server DB. Default: <data_dir>/pushpals.db
# PUSHPALS_DB_PATH=
# Agent-remote idempotency DB. Default: <data_dir>/agent-remote-state.db
# AGENT_REMOTE_DB_PATH=

# -----------------------------------------------------------------------------
# Server / session / auth
# -----------------------------------------------------------------------------
# HTTP port for apps/server.
# Default: 3001
# PUSHPALS_PORT=3001

# Shared session id used by server/agents by default.
# Default: dev
# PUSHPALS_SESSION_ID=dev

# Client-side session id override (Expo requires EXPO_PUBLIC_ prefix).
# If unset, client follows its built-in default flow.
# EXPO_PUBLIC_PUSHPALS_SESSION_ID=dev

# Optional bearer token used by server and agents.
# If set, clients/agents must send Authorization: Bearer <token>.
# PUSHPALS_AUTH_TOKEN=

# Verbose HTTP debug logging (server-side claim/poll visibility).
# Any truthy value (1/true/yes/on) enables.
# DEBUG=1
# PUSHPALS_DEBUG_HTTP=1

# Base URL used by components that read PUSHPALS_SERVER_URL.
# Default: http://localhost:3001
# PUSHPALS_SERVER_URL=http://localhost:3001

# -----------------------------------------------------------------------------
# LLM provider selection (agent-remote)
# -----------------------------------------------------------------------------
# Auto-detection priority:
# 1) OpenAI vars, 2) Anthropic vars, 3) Generic OpenAI-compatible vars, 4) Ollama fallback.

# OpenAI
# OPENAI_API_KEY=
# OPENAI_MODEL=gpt-4o-mini
# OPENAI_API_ENDPOINT=https://api.openai.com

# Anthropic
# ANTHROPIC_API_KEY=
# ANTHROPIC_MODEL=claude-sonnet-4-20250514
# ANTHROPIC_API_ENDPOINT=https://api.anthropic.com

# Generic OpenAI-compatible endpoint (Ollama/vLLM/LM Studio/etc.)
# `LLM_ENDPOINT` is a base URL. The app appends /v1/chat/completions.
# Leave OPENAI_API_KEY/ANTHROPIC_API_KEY unset when using this mode.
# LLM_ENDPOINT=http://localhost:11434
# LLM_MODEL=qwen3-coder:30b
# LLM_API_KEY=ollama

# Agent-local planner model endpoint (optional, separate from agent-remote brain).
# PLANNER_ENDPOINT=http://localhost:11434/api/chat
# LLM_MODEL=qwen3-coder:30b
# PLANNER_API_KEY=ollama

# -----------------------------------------------------------------------------
# Remote agent scheduler (worker routing / autoscaling)
# -----------------------------------------------------------------------------
# Max workers the remote orchestrator should schedule against.
# If online workers are below this cap and auto-spawn is enabled, it can launch
# additional worker processes.
# Default: 1
# REMOTE_AGENT_MAX_WORKERS=1

# Allow remote orchestrator to spawn additional workers when no idle worker exists.
# Default: 1 (enabled)
# REMOTE_AGENT_AUTO_SPAWN_WORKERS=1

# How long remote agent waits for an idle worker before enqueueing without pinning.
# Default: 15000
# REMOTE_AGENT_WAIT_FOR_WORKER_MS=15000

# Worker online heartbeat TTL used by scheduler to treat a worker as online.
# Default: 15000
# REMOTE_AGENT_WORKER_ONLINE_TTL_MS=15000

# How long orchestrator waits for a newly spawned worker to register and become idle.
# Default: 10000
# REMOTE_AGENT_WORKER_STARTUP_TIMEOUT_MS=10000

# Spawned-worker runtime mode (used only for workers launched by orchestrator).
# Default docker mode is enabled/required.
# REMOTE_AGENT_WORKER_DOCKER=1
# REMOTE_AGENT_WORKER_REQUIRE_DOCKER=1
# Optional image override for spawned workers.
# REMOTE_AGENT_WORKER_IMAGE=pushpals-worker-sandbox:latest

# Optional overrides for spawned worker polling/heartbeat/labels.
# REMOTE_AGENT_WORKER_POLL_MS=2000
# REMOTE_AGENT_WORKER_HEARTBEAT_MS=5000
# REMOTE_AGENT_WORKER_LABELS=docker,default

# -----------------------------------------------------------------------------
# Integration branch and serial-pusher behavior
# -----------------------------------------------------------------------------
# Shared integration branch used by:
# - startup precheck in `bun run start`
# - worker default worktree base ref (`origin/<integration-branch>`)
# - serial-pusher default merge target (unless SERIAL_PUSHER_MAIN_BRANCH overrides it)
# Default: main_agents
# PUSHPALS_INTEGRATION_BRANCH=main_agents

# Base branch used when bootstrapping a missing integration branch.
# Startup and serial-pusher create integration branch from origin/<base-branch>.
# Default: main
# PUSHPALS_INTEGRATION_BASE_BRANCH=main

# Optional serial-pusher target-branch override.
# If unset, serial-pusher uses PUSHPALS_INTEGRATION_BRANCH.
# SERIAL_PUSHER_MAIN_BRANCH=main_agents

# Important relationship note:
# SERIAL_PUSHER_MAIN_BRANCH is the branch serial-pusher merges into and pushes.
# During bootstrap of a missing integration branch, we set local branch upstream with:
#   git branch --set-upstream-to origin/<base-branch> <integration-branch>
# That upstream tracks where the integration branch was seeded from.
# Serial-pusher still pushes SERIAL_PUSHER_MAIN_BRANCH to origin.

# Skip serial-pusher clean-repo safety guard (dev-only).
# Also available as CLI flag: --skip-clean-check
# SERIAL_PUSHER_SKIP_CLEAN_CHECK=1

# Repository path used by serial-pusher git operations.
# Strongly recommended: dedicated worktree path so serial-pusher never switches
# branches in your active workspace.
# Default when unset:
#   <repo>/.worktrees/serial-pusher
# If missing, it is auto-created when running `bun run start` or serial-pusher.
# SERIAL_PUSHER_REPO_PATH=

# Disable pushing integration branch after successful merge/checks.
# Default behavior is to push.
# SERIAL_PUSHER_NO_PUSH=1

# Auto-approve serial-pusher creating missing integration branch from origin/<base-branch>.
# If unset, serial-pusher prompts for interactive consent.
# SERIAL_PUSHER_AUTO_CREATE_MAIN_BRANCH=1

# Auto-approve `bun run start` creating/pushing missing origin/<integration-branch>.
# If unset, start prompts for interactive consent.
# PUSHPALS_AUTO_CREATE_INTEGRATION_BRANCH=1

# Legacy alias kept for compatibility with older scripts.
# PUSHPALS_AUTO_CREATE_MAIN_AGENTS=1

# Skip `gh auth status/login` preflight in `bun run start`.
# If push is enabled and no token is set, start otherwise prompts/blocks.
# PUSHPALS_SKIP_GH_AUTH_CHECK=1

# GitHub token used by serial-pusher and optional worker branch push.
# Fallback order used by code: PUSHPALS_GIT_TOKEN -> GITHUB_TOKEN -> GH_TOKEN
# PUSHPALS_GIT_TOKEN=

# -----------------------------------------------------------------------------
# Worker / OpenHands / Docker
# -----------------------------------------------------------------------------
# Worker execution backend.
# openhands = Python OpenHands wrapper; native/builtin/legacy = TS executor path.
# Default: openhands
# WORKER_EXECUTOR=openhands

# Optional: push worker agent branches to origin during commit creation.
# Default: disabled (local branches only).
# WORKER_PUSH_AGENT_BRANCH=1

# Require worker branch push success (implies WORKER_PUSH_AGENT_BRANCH).
# If push fails, job is treated as failed.
# WORKER_REQUIRE_PUSH=1

# Python interpreter used to launch the OpenHands wrapper script.
# In Docker image this is typically /opt/openhands-venv/bin/python.
# WORKER_OPENHANDS_PYTHON=python

# Python interpreter used inside OpenHands workspace command snippets.
# In Docker image this is typically /opt/openhands-venv/bin/python3.
# WORKER_OPENHANDS_WORKSPACE_PYTHON=python3

# Timeout for OpenHands wrapper job execution in milliseconds.
# Default: 120000
# WORKER_OPENHANDS_TIMEOUT_MS=120000

# Worker heartbeat interval in milliseconds. Lower values make worker liveness
# and scheduler routing more responsive but increase server heartbeat traffic.
# Default: 5000
# WORKER_HEARTBEAT_MS=5000

# Optional labels advertised by worker heartbeats (comma-separated).
# Useful for routing or diagnostics.
# WORKER_LABELS=docker,openhands

# Require Docker mode for worker startup.
# If enabled and Docker isn't usable, worker exits instead of falling back.
# WORKER_REQUIRE_DOCKER=1

# Docker image used by worker docker executor.
# Default: pushpals-worker-sandbox:latest
# WORKER_DOCKER_IMAGE=pushpals-worker-sandbox:latest

# Job timeout for docker executor containers (milliseconds).
# Default: 60000
# WORKER_DOCKER_TIMEOUT_MS=60000

# Skip worker startup Docker git/worktree self-check.
# Default: self-check runs when docker mode is enabled.
# WORKER_SKIP_DOCKER_SELF_CHECK=1

# Base ref for worker job worktrees.
# Default: origin/<PUSHPALS_INTEGRATION_BRANCH> (with runtime fallbacks).
# WORKER_BASE_REF=origin/main_agents
