# PushPals Environment
# Copy this file to `.env` and uncomment values you want to override.
# Bun loads `.env` from the repository root.

# -----------------------------------------------------------------------------
# Data paths
# -----------------------------------------------------------------------------
# Base directory for app state (SQLite files, SourceControlManager state, etc.).
# Default: <repo>/outputs/data
# PUSHPALS_DATA_DIR=./outputs/data

# Override specific DB locations (absolute path or path relative to PUSHPALS_DATA_DIR).
# Server DB. Default: <data_dir>/pushpals.db
# PUSHPALS_DB_PATH=
# RemoteBuddy idempotency DB. Default: <data_dir>/remotebuddy-state.db
# REMOTEBUDDY_DB_PATH=

# -----------------------------------------------------------------------------
# Server / session / auth
# -----------------------------------------------------------------------------
# HTTP port for apps/server.
# Default: 3001
# PUSHPALS_PORT=3001

# Shared session id used by server/agents by default.
# Default: dev
# PUSHPALS_SESSION_ID=dev

# Client-side session id override (Expo requires EXPO_PUBLIC_ prefix).
# If unset, client follows its built-in default flow.
# EXPO_PUBLIC_PUSHPALS_SESSION_ID=dev

# Client API base URL (Expo app).
# Default: http://localhost:3001
EXPO_PUBLIC_PUSHPALS_URL=http://localhost:3001

# LocalBuddy URL used by client message send flow.
# Default: http://localhost:3003
EXPO_PUBLIC_LOCAL_AGENT_URL=http://localhost:3003

# `EXPO_OS` is injected by Expo/Metro at build time and is not user-configured.

# LocalBuddy HTTP port.
# Default: 3003
LOCAL_AGENT_PORT=3003

# Optional bearer token used by server and agents.
# If set, clients/agents must send Authorization: Bearer <token>.
# PUSHPALS_AUTH_TOKEN=

# Verbose HTTP debug logging (server-side claim/poll visibility).
# Any truthy value (1/true/yes/on) enables.
# DEBUG=1
# PUSHPALS_DEBUG_HTTP=1

# Base URL used by components that read PUSHPALS_SERVER_URL.
# Default: http://localhost:3001
PUSHPALS_SERVER_URL=http://localhost:3001

# Smoke-test script server URL (scripts/smoke-test.ts).
# Default: http://localhost:3001
PUSHPALS_URL=http://localhost:3001

# -----------------------------------------------------------------------------
# LLM provider selection (RemoteBuddy)
# -----------------------------------------------------------------------------
# Auto-detection priority:
# 1) OpenAI vars, 2) Anthropic vars, 3) Generic OpenAI-compatible vars, 4) Ollama fallback.

# OpenAI
# OPENAI_API_KEY=
# OPENAI_MODEL=gpt-4o-mini
# OPENAI_API_ENDPOINT=https://api.openai.com

# Anthropic
# ANTHROPIC_API_KEY=
# ANTHROPIC_MODEL=claude-sonnet-4-20250514
# ANTHROPIC_API_ENDPOINT=https://api.anthropic.com

# Generic OpenAI-compatible endpoint (Ollama/vLLM/LM Studio/etc.)
# `LLM_ENDPOINT` is a base URL. The app appends /v1/chat/completions.
# Leave OPENAI_API_KEY/ANTHROPIC_API_KEY unset when using this mode.
LLM_ENDPOINT=http://localhost:11434
LLM_MODEL=qwen3-coder:30b
LLM_API_KEY=ollama
# Optional aliases also accepted by WorkerPals OpenHands wrapper.
# LLM_BASE_URL=http://localhost:11434/v1
# OPENAI_BASE_URL=https://api.openai.com/v1

# LocalBuddy planner model endpoint (optional, separate from RemoteBuddy brain).
PLANNER_ENDPOINT=http://localhost:11434/api/chat
PLANNER_MODEL=qwen3-coder:30b
PLANNER_API_KEY=ollama

# -----------------------------------------------------------------------------
# RemoteBuddy scheduler (WorkerPals routing / autoscaling)
# -----------------------------------------------------------------------------
# Max WorkerPals that RemoteBuddy should schedule against.
# If online workers are below this cap and auto-spawn is enabled, it can launch
# additional WorkerPal processes.
# Default: 1
REMOTEBUDDY_MAX_WORKERPALS=1

# Allow RemoteBuddy to spawn additional WorkerPals when no idle worker exists.
# Default: 1 (enabled)
# REMOTEBUDDY_AUTO_SPAWN_WORKERPALS=1

# How long RemoteBuddy waits for an idle WorkerPal before enqueueing without pinning.
# Default: 15000
# REMOTEBUDDY_WAIT_FOR_WORKERPAL_MS=15000

# WorkerPal online heartbeat TTL used by scheduler to treat a WorkerPal as online.
# Default: 15000
# REMOTEBUDDY_WORKERPAL_ONLINE_TTL_MS=15000

# How long RemoteBuddy waits for a newly spawned WorkerPal to register and become idle.
# Default: 10000
# REMOTEBUDDY_WORKERPAL_STARTUP_TIMEOUT_MS=10000

# Spawned WorkerPals runtime mode (used only for workers launched by RemoteBuddy).
# Default docker mode is enabled/required.
REMOTEBUDDY_WORKERPAL_DOCKER=1
REMOTEBUDDY_WORKERPAL_REQUIRE_DOCKER=1
# Optional image override for spawned WorkerPals.
# REMOTEBUDDY_WORKERPAL_IMAGE=pushpals-worker-sandbox:latest

# Optional overrides for spawned WorkerPals polling/heartbeat/labels.
# RemoteBuddy request-queue poll interval.
# REMOTEBUDDY_POLL_MS=2000
# REMOTEBUDDY_WORKERPAL_POLL_MS=2000
# REMOTEBUDDY_WORKERPAL_HEARTBEAT_MS=5000
# REMOTEBUDDY_WORKERPAL_LABELS=docker,default

# -----------------------------------------------------------------------------
# Integration branch and SourceControlManager behavior
# -----------------------------------------------------------------------------
# Shared integration branch used by:
# - startup precheck in `bun run start`
# - WorkerPals default worktree base ref (`origin/<integration-branch>`)
# - SourceControlManager default merge target (unless SOURCE_CONTROL_MANAGER_MAIN_BRANCH overrides it)
# Default: main_agents
PUSHPALS_INTEGRATION_BRANCH=main_agents

# Base branch used when bootstrapping a missing integration branch.
# Startup and SourceControlManager create integration branch from origin/<base-branch>.
# Default: main
PUSHPALS_INTEGRATION_BASE_BRANCH=main

# Optional SourceControlManager target-branch override.
# If unset, SourceControlManager uses PUSHPALS_INTEGRATION_BRANCH.
SOURCE_CONTROL_MANAGER_MAIN_BRANCH=main_agents

# Important relationship note:
# SOURCE_CONTROL_MANAGER_MAIN_BRANCH is the branch SourceControlManager merges into and pushes.
# During bootstrap of a missing integration branch, we set local branch upstream with:
#   git branch --set-upstream-to origin/<base-branch> <integration-branch>
# That upstream tracks where the integration branch was seeded from.
# SourceControlManager still pushes SOURCE_CONTROL_MANAGER_MAIN_BRANCH to origin.

# Skip SourceControlManager clean-repo safety guard (dev-only).
# Also available as CLI flag: --skip-clean-check
SOURCE_CONTROL_MANAGER_SKIP_CLEAN_CHECK=1

# Repository path used by SourceControlManager git operations.
# Strongly recommended: dedicated worktree path so SourceControlManager never switches
# branches in your active workspace.
# Default when unset:
#   <repo>/.worktrees/source_control_manager
# If missing, it is auto-created when running `bun run start` or SourceControlManager.
# SOURCE_CONTROL_MANAGER_REPO_PATH=

# Disable pushing integration branch after successful merge/checks.
# Default behavior is to push.
# SOURCE_CONTROL_MANAGER_NO_PUSH=1

# Auto-approve SourceControlManager creating missing integration branch from origin/<base-branch>.
# If unset, SourceControlManager prompts for interactive consent.
# SOURCE_CONTROL_MANAGER_AUTO_CREATE_MAIN_BRANCH=1

# Auto-approve `bun run start` creating/pushing missing origin/<integration-branch>.
# If unset, start prompts for interactive consent.
# PUSHPALS_AUTO_CREATE_INTEGRATION_BRANCH=1

# Skip `gh auth status/login` preflight in `bun run start`.
# If push is enabled and no token is set, start otherwise prompts/blocks.
# PUSHPALS_SKIP_GH_AUTH_CHECK=1

# GitHub token used by SourceControlManager and optional WorkerPals branch push.
# Fallback order used by code: PUSHPALS_GIT_TOKEN -> GITHUB_TOKEN -> GH_TOKEN
# PUSHPALS_GIT_TOKEN=
# GITHUB_TOKEN=
# GH_TOKEN=
# Internal container token (set automatically by WorkerPals Docker executor).
# Only set directly if you run the Docker job runner manually.
# GIT_TOKEN=

# -----------------------------------------------------------------------------
# WorkerPals / OpenHands / Docker
# -----------------------------------------------------------------------------
# WorkerPals execution backend.
# openhands = Python OpenHands wrapper.
# Default: openhands
# WORKERPALS_EXECUTOR=openhands

# Optional: push WorkerPals agent branches to origin during commit creation.
# Default: disabled (local branches only).
# WORKERPALS_PUSH_AGENT_BRANCH=1

# Require WorkerPals branch push success (implies WORKERPALS_PUSH_AGENT_BRANCH).
# If push fails, job is treated as failed.
# WORKERPALS_REQUIRE_PUSH=1

# Python interpreter used to launch the OpenHands wrapper script.
# In Docker image this is typically /opt/openhands-venv/bin/python.
# WORKERPALS_OPENHANDS_PYTHON=python

# Python interpreter used inside OpenHands workspace command snippets.
# In Docker image this is typically /opt/openhands-venv/bin/python3.
# WORKERPALS_OPENHANDS_WORKSPACE_PYTHON=python3

# Timeout for OpenHands wrapper job execution in milliseconds.
# Default: 120000
# WORKERPALS_OPENHANDS_TIMEOUT_MS=120000

# LLM configuration for OpenHands agentic task execution (instruction-only task.execute).
# Used when a task does not specify targetPath and worker needs to autonomously edit code.
# If omitted, worker falls back to deterministic modes or fails with guidance.
# WORKERPALS_OPENHANDS_MODEL=qwen3-coder:30b
# WORKERPALS_OPENHANDS_API_KEY=ollama
# WORKERPALS_OPENHANDS_BASE_URL=http://host.docker.internal:11434/v1

# Max planning/execution steps for OpenHands agent task.execute mode.
# Default: 30
# WORKERPALS_OPENHANDS_AGENT_MAX_STEPS=30

# WorkerPal heartbeat interval in milliseconds. Lower values make worker liveness
# and scheduler routing more responsive but increase server heartbeat traffic.
# Default: 5000
# WORKERPALS_HEARTBEAT_MS=5000

# WorkerPal request-queue poll interval.
# Default: 2000
# WORKERPALS_POLL_MS=2000

# Optional labels advertised by WorkerPals heartbeats (comma-separated).
# Useful for routing or diagnostics.
WORKERPALS_LABELS=docker,openhands

# Require Docker mode for WorkerPals startup.
# If enabled and Docker isn't usable, WorkerPals exits instead of falling back.
WORKERPALS_REQUIRE_DOCKER=1

# Docker image used by WorkerPals docker executor.
# Default: pushpals-worker-sandbox:latest
# WORKERPALS_DOCKER_IMAGE=pushpals-worker-sandbox:latest

# Job timeout for docker executor containers (milliseconds).
# Default: 60000
# WORKERPALS_DOCKER_TIMEOUT_MS=60000

# Skip WorkerPals startup Docker git/worktree self-check.
# Default: self-check runs when docker mode is enabled.
# WORKERPALS_SKIP_DOCKER_SELF_CHECK=1

# Base ref for WorkerPals job worktrees.
# Default: origin/<PUSHPALS_INTEGRATION_BRANCH> (with runtime fallbacks).
# WORKERPALS_BASE_REF=origin/main_agents
